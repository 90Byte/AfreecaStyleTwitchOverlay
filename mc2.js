// Generated by IcedCoffeeScript 1.8.0-d
(function() {
  var defaults, getOption, lastMessageTime, tmi, urlVars;

  defaults = {
    channel: 'hatsuney'
  };

  lastMessageTime = 0;

  urlVars = {};

  window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, (function(_this) {
    return function(m, key, value) {
      return urlVars[key] = value;
    };
  })(this));

  getOption = function(optionName) {
    if (urlVars[optionName] != null) {
      return urlVars[optionName];
    } else if (defaults[optionName] != null) {
      return defaults[optionName];
    } else {
      return null;
    }
  };

  tmi = new irc.client({
    options: {
      debug: true
    },
    channels: [getOption('channel')]
  });

  tmi.on('connected', (function(_this) {
    return function() {
      return tmi.emit('message', {}, {
        username: 'Mikuchat'
      }, 'Connected!', null);
    };
  })(this));

  tmi.on('message', (function(_this) {
    return function(channel, user, message, self) {
      setTimeout(function() {
        return $('body').append(' <span class="message animation-slide-up" style="border-left: 5px solid ' + user.color + ';"> <small class="pull-right time">' + moment().format('HH:mm') + '</small> <b class="pull-left" style="padding-left: 3px;">' + user.username + '</b> <br /> ' + message.replace(/(<([^>]+)>)/ig, "") + ' </span>');
      }, lastMessageTime);
      lastMessageTime += 1500;
      console.log(channel);
      console.log(user);
      return console.log(message);
    };
  })(this));

  tmi.connect();

  tmi.emit('message', {}, {
    username: 'Mikuchat'
  }, 'Hi there! Connecting to #' + getOption('channel') + '...', null);

  setInterval((function(_this) {
    return function() {
      lastMessageTime -= 500;
      if (lastMessageTime < 0) {
        return lastMessageTime = 0;
      }
    };
  })(this), 500);

}).call(this);
